{"version":3,"sources":["sound-loader.min.js"],"names":["global","soundLoader","groups","caches","initialized","VALIDATE_PATH_REG","createjs","Sound","registerPlugins","HTMLAudioPlugin","source","id","data","group","groupId","success","error","fileLength","complete","replace","c","r","Math","random","v","toString","Promise","resolve","reject","cache","altId","request","path","manifest","Array","isArray","isUndefined","forEach","obj","i","isString","src","getFileName","isNumber","isObject","order","push","Object","keys","key","length","registerSounds","result","sort","a","b","on","loadSuccess","loadError","event","find","audioSprite","map","p","Infinity","concat","matched","match","value","prototype","call","this"],"mappings":"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","file":"sound-loader.min.js","sourcesContent":["/*\r\n * SoundLoader.js 0.0.3\r\n * \r\n * SoundJSライブラリ使用の音楽ファイル簡易ローダー\r\n * \r\n * -- 使い方 --\r\n * (1) 音楽ファイルをひとつだけ登録する場合\r\n * soundLoader()メソッドの第1引数に音楽ファイルのパスを指定する（必須）。必要であれば第2引数にID名を、第3引数にdataプロパティを指定できるがこれらは省略が可能。ID名を省略した場合、音楽ファイルの拡張子を除いたファイル名に自動的にIDが割り振られるので注意が必要（音楽を鳴らすときIDが必要になる）。\r\n *\r\n * var deferred = soundLoader('sound-1.mp3', 'main-bgm');\r\n *\r\n * また、これらの情報をオブジェクトに格納した形でメソッドに渡すこともできる。\r\n * var deferred = $.soundLoader({ src: 'sound-1.mp3', id: 'main-bgm' });\r\n *\r\n * 複数の音楽ファイルを一度に渡したいときは、上記のオブジェクトを要素とした配列を指定する。\r\n * var soundFiles = [\r\n *     { src: 'sound-1.mp3', id: 'main-bgm' },\r\n *     { src: 'sound-2.mp3', id: 'sub-bgm' },\r\n *     { src: 'sound-3.mp3', id: 'gameover-bgm' }\r\n * ];\r\n *\r\n * var deferred = soundLoader(soundFiles);\r\n *\r\n * さらにSoundJSに準じたオーディオスプライトなどの高度なデータの指定ができる。\r\n * var soundFiles = [\r\n *     {\r\n *         src: \"sound-1.mp3\",\r\n *         data: {\r\n *             audioSprite: [\r\n *                 {id: \"audio-sprite1\", startTime: 0, duration: 1000},\r\n *                 {id: \"audio-sprite2\", startTime: 1500, duration: 1000}\r\n *             ]\r\n *         }\r\n *     },\r\n *     {id \"sound-2\", src: \"/audio/bgm/sound-3.mp3\", data: 5}\r\n * ];\r\n * \r\n * 返り値はPromiseオブジェクトとなる。これを変数に格納しておき、done()やthen()メソッドにつないでファイルのロード終了後の処理を記述する。\r\n * なお、メソッドの第2引数にファイルまでのパスを指定できる。\r\n * \r\n * var deferred = soundLoader(soundFiles, basePath);\r\n *\r\n * ひとつでも読み込みに成功した音楽ファイルがあれば、成功時のコールバックが呼び出される。結果は第1引数にオブジェクトとして渡され、読み込みに成功した音楽ファイルのリストがそのsuccessプロパティに、失敗したファイルのリストがerrorプロパティに格納される。\r\n * すべての音楽ファイルが読み込みに失敗したときだけ、失敗時のコールバックが呼び出される。この場合、第1引数に同様のオブジェクトが渡される。\r\n * \r\n * deferred.done(function (result) {\r\n *     if (typeof result.success !== 'undefined') {\r\n *         doSomething(result.success);\r\n *     }\r\n * });\r\n * \r\n * 音楽データはハッシュ形式で次のようなプロパティを持つ。IDプロパティはcreatejs.Sound.play()メソッドなどを利用するときに必要になる。読み込みに失敗したデータについては、失敗した理由がerrorプロパティに格納される。\r\n * { id: 'sound-1', src: 'sound-1.mp3' }\r\n * \r\n * createjs.Sound.play('sound-1');\r\n*/\r\n\r\n;(function (global) {\r\n    'use strict';\r\n\r\n    var soundLoader, groups, caches, initialized, VALIDATE_PATH_REG, DEFAULT_CHANNELS;\r\n    groups = {};\r\n    caches = [];\r\n    initialized = false;\r\n    VALIDATE_PATH_REG = /(.*\\/)?([^\\/]+?)\\.(mp3|ogg|opus|mpeg|wav|m4a|mp4|aiff|wma|mid)$/;\r\n    DEFAULT_CHANNELS = 100;\r\n\r\n    createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);\r\n\r\n    soundLoader = function (source, id, data) {\r\n        var group, groupId;\r\n        group = {\r\n            id: '',\r\n            success: [],\r\n            error: [],\r\n            fileLength: 0,\r\n            complete: null\r\n        };\r\n        groupId = createUUID();\r\n        group.id= groupId;\r\n        groups[groupId] = group;\r\n        \r\n        return new Promise(function (resolve, reject) {\r\n            var cache, altId, request, path, manifest, fileLength;\r\n\r\n            if (Array.isArray(source)) {\r\n                manifest = [];\r\n                path = !isUndefined(id) ? id : '';\r\n                \r\n                source.forEach(function (obj, i) {\r\n                    if (isString(obj.src)) {\r\n                        altId = getFileName(obj.src);\r\n\r\n                        if (altId !== '') {\r\n                            request = {src: obj.src};\r\n                            request.id = !isUndefined(obj.id) ? obj.id : altId;\r\n                            request.data = isNumber(obj.data) || isObject(obj.data) ? obj.data : DEFAULT_CHANNELS;\r\n\r\n                            cache = {\r\n                                src: request.src,\r\n                                id: request.id,\r\n                                order: i,\r\n                                groupId: groupId\r\n                            };\r\n                            caches.push(cache);\r\n                            manifest.push(request);\r\n\r\n                        } else {\r\n                            group.error.push({id: altId, src: obj.src, error: 'invalid file'});\r\n                        }\r\n                    } else {\r\n                        request = {id: obj.id, src: {}};\r\n                        request.data = isNumber(obj.data) || isObject(obj.data) ? obj.data : DEFAULT_CHANNELS;\r\n                        \r\n                        Object.keys(obj.src).forEach(function (key) {\r\n                            altId = getFileName(obj.src[key]);\r\n                            if (altId !== '') {\r\n                                request.src[key] = obj.src[key];\r\n                                \r\n                            } else {\r\n                                group.error.push({id: altId, src: obj.src[key], error: 'invalid alternate file'});\r\n                            }\r\n                        });\r\n                        \r\n                        cache = {\r\n                            src: request.src,\r\n                            id: request.id,\r\n                            order: i,\r\n                            groupId: groupId\r\n                        };\r\n                        caches.push(cache);\r\n                        manifest.push(request);\r\n                    }\r\n                });\r\n            } else {\r\n                if (isString(source)) {\r\n                    path = '';\r\n                    altId = getFileName(source);\r\n                    if (altId !== '') {\r\n                        request = {src: source};\r\n                        request.id = isString(id) ? id : altId;\r\n                        request.data = isNumber(data) || isObject(data) ? data : DEFAULT_CHANNELS;\r\n\r\n                        cache = {\r\n                            src: request.src,\r\n                            id: request.id,\r\n                            order: 0,\r\n                            groupId: groupId\r\n                        };\r\n                        caches.push(cache);\r\n                        manifest = [request];\r\n                        \r\n                    } else {\r\n                        group.error.push({id: altId, src: source, error: 'invalid file'});\r\n                    }\r\n                    \r\n                } else if (isObject(source)) {\r\n                    path = !isUndefined(id) ? id : '';\r\n                    if (isString(source.src)) {\r\n                        altId = getFileName(source.src);\r\n                        if (altId !== '') {\r\n                            request = {src: source.src};\r\n                            request.id = !isUndefined(source.id) ? source.id : altId;\r\n                            request.data = isNumber(source.data) || isObject(source.data) ? source.data : DEFAULT_CHANNELS;\r\n\r\n                            cache = {\r\n                                src: request.src,\r\n                                id: request.id,\r\n                                order: 0,\r\n                                groupId: groupId\r\n                            };\r\n                            caches.push(cache);\r\n                            manifest = [request];\r\n\r\n                        } else {\r\n                            group.error.push({id: altId, src: source.src, error: 'invalid file'});\r\n                        }\r\n                    } else {\r\n                        request = {id: source.id, src: {}};\r\n                        request.data = isNumber(source.data) || isObject(source.data) ? source.data : DEFAULT_CHANNELS;\r\n                        \r\n                        Object.keys(source.src).forEach(function (key) {\r\n                            altId = getFileName(source.src[key]);\r\n                            if (altId !== '') {\r\n                                request.src[key] = source.src[key];\r\n                                \r\n                            } else {\r\n                                group.error.push({id: altId, src: source.src[key], error: 'invalid alternate file'});\r\n                            }\r\n                        });\r\n                        \r\n                        cache = {\r\n                            src: request.src,\r\n                            id: request.id,\r\n                            order: 0,\r\n                            groupId: groupId\r\n                        };\r\n                        caches.push(cache);\r\n                        manifest = [request];\r\n                    }\r\n                }\r\n            }\r\n            \r\n            group.fileLength = manifest.length;\r\n            createjs.Sound.registerSounds(manifest, path);\r\n            \r\n            group.complete = function () {\r\n                var result, index;\r\n                result = {};\r\n                \r\n                if (group.success.length > 0) {\r\n                    group.success.sort(function (a, b) {\r\n                        if (a.order < b.order) {\r\n                            return -1;\r\n                        } else if (a.order > b.order) {\r\n                            return 1;\r\n                        } else {\r\n                            return 0;\r\n                        }\r\n                    });\r\n                    result.success = group.success;\r\n                    \r\n                    if (group.error.length > 0) {\r\n                        result.error = group.error;\r\n                    }\r\n                    resolve(result);\r\n                    \r\n                } else {\r\n                    result.error = group.error;\r\n                    reject(result);\r\n                }\r\n                \r\n                groups[group.id] = null;\r\n                group = null;\r\n            };\r\n            \r\n            if (!initialized) {\r\n                initialized = true;\r\n                createjs.Sound.on('fileload', loadSuccess);\r\n                createjs.Sound.on('fileerror', loadError);\r\n            }\r\n        });\r\n    };\r\n\r\n    global.soundLoader = soundLoader;\r\n    \r\n    function createUUID() {\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    }\r\n    \r\n    function loadSuccess(event) {\r\n        var id, src, group, cache, data;\r\n        id = event.id;\r\n        src = event.src;\r\n        cache = caches.find(function (c) {\r\n            return c.id === id;\r\n        });\r\n        cache.src = src;\r\n        \r\n        Object.keys(groups).forEach(function (key) {\r\n            if (cache.groupId === key) {\r\n                group = groups[key];\r\n            }\r\n        });\r\n        \r\n        group.fileLength -= 1;\r\n\r\n        if (isObject(event.data) && !isUndefined(event.data.audioSprite)) {\r\n            data = event.data.audioSprite.map(function (p) {\r\n                return {id: p.id, src: src, order: Infinity};\r\n            });\r\n            group.success = group.success.concat(data);\r\n        }\r\n\r\n        group.success.push(cache);\r\n            if (group.fileLength === 0) {\r\n            group.complete();\r\n        }\r\n    }\r\n\r\n    function loadError(event) {\r\n        var id, src, cache, group;\r\n        id = event.id;\r\n        src = event.src;\r\n        \r\n        cache = caches.find(function (c) {\r\n            return c.id === id;\r\n        });\r\n        \r\n        Object.keys(groups).forEach(function (key) {\r\n            if (cache.groupId === key) {\r\n                group = groups[key];\r\n            }\r\n        });\r\n        \r\n        group.error.push({id: id, src: src, error: 'load error'});\r\n        group.fileLength -= 1;\r\n        if (group.fileLength === 0) {\r\n            group.complete();\r\n        }\r\n    }\r\n\r\n    function getFileName(source) {\r\n        var result, matched;\r\n        result = '';\r\n        matched = source.match(VALIDATE_PATH_REG);\r\n        if (matched !== null) {\r\n            result =  matched[2];\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function isString(value) {\r\n        return Object.prototype.toString.call(value) === '[object String]';\r\n    }\r\n    \r\n    function isNumber(value) {\r\n        return Object.prototype.toString.call(value) === '[object Number]';\r\n    }\r\n\r\n    function isObject(value) {\r\n        return typeof value === 'object' && value !== null && !Array.isArray(value);\r\n    }\r\n\r\n    function isUndefined(value) {\r\n        return typeof value === 'undefined';\r\n    }\r\n}(this));"]}